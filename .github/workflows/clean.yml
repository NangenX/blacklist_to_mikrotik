name: Force_Clean_History_Once

on:
  workflow_dispatch: # è¿™å…è®¸ä½ åœ¨ GitHub ç½‘é¡µä¸Šç‚¹å‡» "Run workflow" æ‰‹åŠ¨è§¦å‘

jobs:
  reset-repo:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 

      - name: Reset to 1 Commit
        run: |
          # 1. é…ç½® Git èº«ä»½
          git config --global user.name "GitHub Action"
          git config --global user.email "github-action@users.noreply.github.com"
          
          # 2. åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„ã€æ²¡æœ‰å†å²çš„åˆ†æ”¯
          git checkout --orphan latest_branch
          
          # 3. æäº¤å½“å‰æ‰€æœ‰æ–‡ä»¶ (åªä¿ç•™è„šæœ¬æœ¬èº«)
          git add -A
          git commit -m "ğŸš€ Repository Reset: Removed 20k legacy commits"
          
          # 4. å¼ºåˆ¶è¦†ç›–ä¸»åˆ†æ”¯
          git branch -D main || true
          git branch -m main
          
          # 5. å¼ºåˆ¶æ¨é€åˆ°äº‘ç«¯ï¼ŒæŠ¹æ‰æ‰€æœ‰ 2 ä¸‡æ¬¡è®°å½•
          git remote set-url origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.git
          git push -f origin main